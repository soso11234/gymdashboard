<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .card { box-shadow: 0 4px 10px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto space-y-8">
        <header class="flex justify-between items-center pb-4 border-b border-indigo-300">
            <h1 class="text-3xl font-bold text-indigo-700">Welcome, {{ data.member_name }}!</h1>
            <a href="{{ url_for('logout') }}" class="text-sm font-medium text-gray-500 hover:text-gray-900 bg-white px-3 py-1 rounded-md border hover:border-indigo-300 transition duration-150">Logout</a>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="space-y-2">
                    {% for category, message in messages %}
                        <div class="p-3 text-sm rounded-md {% if category == 'error' %}bg-red-100 text-red-800{% elif category == 'success' %}bg-green-100 text-green-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <main class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            
            <!-- Left Column: Metrics & Goals -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Profile Management -->
                <div class="card bg-white p-6 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">Account & Billing</h2>
                    <div class="flex justify-between items-center text-sm">
                        <p class="font-medium text-gray-700">Billing Status (INVOICE)</p>
                        <!-- Placeholder for actual data -->
                        <span class="px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending - $45.00</span>
                    </div>
                    <div class="flex justify-between items-center text-sm mt-3">
                        <p class="font-medium text-gray-700">Profile Details (MEMBER)</p>
                        <!-- Updated link to the new edit profile page -->
                        <a href="{{ url_for('show_edit_profile') }}" class="text-indigo-600 hover:text-indigo-800 font-medium">Edit Contact Info</a>
                    </div>
                    <a href="#" class="block w-full text-center text-sm font-medium text-gray-600 hover:text-gray-900 transition duration-150 mt-4 border-t pt-3">View Billing History</a>
                </div>

                <!-- Latest Health Metrics -->
                <div class="card bg-white p-6 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">Latest Health Metrics</h2>
                    <ul class="space-y-3">
                        {% for metric in data.metrics %}
                        <li class="flex justify-between text-sm">
                            <span class="text-gray-500">{{ metric.record_date }}</span>
                            <div class="space-x-4">
                                <span class="font-medium text-gray-700">{{ metric.weight }} lbs</span>
                                <span class="font-medium text-indigo-600">{{ metric.heart_rate }} BPM</span>
                            </div>
                        </li>
                        {% endfor %}
                        {% if not data.metrics %}
                        <li class="text-sm text-gray-500">No metrics logged yet.</li>
                        {% endif %}
                    </ul>
                    <a href="#" class="block w-full text-center py-2 mt-4 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-indigo-100 transition duration-150">Log New Metric</a>
                </div>

                <!-- Fitness Goals -->
                <div class="card bg-white p-6 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">Active Fitness Goals</h2>
                    <ul class="space-y-4">
                        {% for goal in data.goals %}
                        <li class="border-b last:border-b-0 pb-3">
                            <p class="text-sm font-semibold text-gray-800 mb-1">{{ goal.target_type }}</p>
                            <div class="text-xs text-gray-500">
                                <p>Target Value: <span class="font-medium text-gray-700">{{ goal.target_value }}</span></p>
                                <p>Due Date: <span class="font-medium text-gray-700">{{ goal.end_date }}</span></p>
                                <p>Goal ID: <span class="font-mono text-indigo-500">{{ goal.goal_id }}</span></p>
                            </div>
                        </li>
                        {% endfor %}
                        {% if not data.goals %}
                        <li class="text-sm text-gray-500">No active goals defined.</li>
                        {% endif %}
                    </ul>
                    <a href="#" class="block w-full text-center py-2 mt-4 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-indigo-100 transition duration-150">Update/Set New Goal</a>
                </div>
            </div>

            <!-- Right Column: Classes & Training -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Registered Classes -->
                <div class="card bg-white p-6 rounded-xl">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">My Upcoming Classes</h2>
                    <div class="space-y-4">
                        {% for class in data.classes %}
                        <div class="flex justify-between items-center p-3 bg-indigo-50 rounded-lg border border-indigo-200">
                            <div class="space-y-1">
                                <p class="font-semibold text-indigo-700">{{ class.class_type }} (ID: {{ class.class_id }})</p>
                                <p class="text-sm text-gray-600">
                                    {{ class.start_time }} | Room: {{ class.room_id }} | Trainer: {{ class.trainer_id }}
                                </p>
                            </div>
                            <form action="{{ url_for('api_cancel_enrollment') }}" method="POST">
                                <input type="hidden" name="class_id" value="{{ class.class_id }}">
                                <button type="submit" class="text-xs font-medium px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150">
                                    Cancel
                                </button>
                            </form>
                        </div>
                        {% endfor %}
                        {% if not data.classes %}
                        <p class="text-sm text-gray-500">You are not currently enrolled in any upcoming classes.</p>
                        {% endif %}
                    </div>

                    <div class="mt-6 border-t pt-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Personal Training</h3>
                        <div class="flex space-x-4">
                            <button class="flex-1 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition duration-150">View Sessions</button>
                            <button class="flex-1 py-2 text-sm font-medium text-white bg-pink-600 rounded-md hover:bg-pink-700 transition duration-150">Book New Session</button>
                        </div>
                    </div>

                    <a href="{{ url_for('show_class_schedule') }}" class="block w-full text-center py-2 mt-4 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-indigo-100 transition duration-150">Browse & Book New Sessions/Classes</a>
                </div>
                
            </div>
        </main>
    </div>
</body>
</html>